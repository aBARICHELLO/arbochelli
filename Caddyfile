{
    email webmaster@arbochelli.me
}

log.{$DOMAIN:localhost} {
    reverse_proxy http://localhost:3000
}

{$DOMAIN2} www.{$DOMAIN:localhost} {
    redir https://{$DOMAIN:localhost}{uri}
}

r.{$DOMAIN:localhost} {
    root * redirect
    redir /static/* https://{$DOMAIN:localhost}{uri}
    file_server {
        index redirect.html
    }
    handle_errors {
        respond "{http.error.status_code} {http.error.status_text}"
    }
}

{$DOMAIN:localhost} {$ONION_ADDR} {
    templates
    encode zstd gzip
    header Onion-Location {$ONION_ADDR}

    import redirect/rewrite.txt
    redir /favicon.ico /static/favicon.png
    redir /p/* https://r.{$DOMAIN:localhost}/?r={http.request.uri.path.1}

    file_server {
        hide .git* .mscbackup .vscode *.html *.sh *.code-workspace README.md redirect src static tmp
        browse template.html
    }

    file_server /static/* {
        browse template.html
    }

    handle_errors {
        respond "{http.error.status_code} {http.error.status_text}"
    }

    log {
        format json
        output file /tmp/arbochelli.log {
            roll_size 200mb
            roll_keep 5
        }
    }
}
