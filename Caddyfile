log.{$DOMAIN:localhost} {
    reverse_proxy http://localhost:3000
}

pdf.{$DOMAIN:localhost} {
    root * redirect
    file_server
    handle_errors {
        respond "{http.error.status_code} {http.error.status_text}"
    }
}

{$DOMAIN:localhost} http://basssssxls7b72rf6b2nngxcwhndx6r2k42bcbyx6dkeps7ilh3nwlqd.onion {
    templates
    encode zstd gzip
    header Onion-Location http://basssssxls7b72rf6b2nngxcwhndx6r2k42bcbyx6dkeps7ilh3nwlqd.onion

    import redirect/rewrite.txt
    rewrite / {uri}?sort=name&order=desc
    redir /p/* https://pdf.{$DOMAIN:localhost}?r={http.request.uri.path.1}

    file_server {
        hide .git* tmp *.html .mscbackup redirect *.sh .vscode *.code-workspace
        browse template.html
    }

    handle_errors {
        respond "{http.error.status_code} {http.error.status_text}"
    }

    log {
        format json
        output file /tmp/arbochelli.log {
            roll_size 200mb
            roll_keep 5
        }
    }
}
